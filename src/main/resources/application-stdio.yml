# Profile for MCP STDIO mode - logging to file only (not stdout).
#
# NOTE: We do NOT set web-application-type=none here because GraalVM native
# images compile all bean definitions at build time (AOT). Disabling the
# servlet context at runtime causes "No ServletContext set" crashes since
# the AOT-compiled web beans still expect it. Instead, we let the embedded
# web server start on an ephemeral port (harmless) and only redirect
# logging to a file so stdout stays clean for JSON-RPC.
spring:
  main:
    banner-mode: off

server:
  port: 0   # random ephemeral port -- avoids conflicts, not exposed

# MCP STDIO transport uses stdout for JSON-RPC.
# Console logging MUST be disabled to avoid corrupting the protocol.
#
# Two-layer protection:
#   1. logback-stdio.xml replaces the default logback config with FILE-only appender.
#   2. logging.threshold.console=OFF disables the console appender via Spring Boot's
#      built-in property -- acts as a safety net if the XML config fails to load
#      (e.g. GraalVM native-image resource issues).
#   3. logging.file.name enables the built-in file appender as a fallback destination.
logging:
  config: classpath:logback-stdio.xml
  threshold:
    console: "OFF"
  file:
    name: ${user.home}/.websearch/mcp-server.log

# Each STDIO session gets its own Lucene index so multiple Cursor windows
# (or other MCP clients) can run concurrently without write-lock conflicts.
# Searches merge results from both the per-session index and the shared index.
websearch:
  store:
    agent-id: mcp-${random.uuid}
